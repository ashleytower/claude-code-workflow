# Global Claude Code Rules

## Core Behavior

**Style:** No emojis. No celebration messages. Facts only.

**Before editing:** Read the file first. Check existing patterns with Grep.

**After completing work:** Summarize what was done.

## External Services

Use Rube MCP for: Supabase, Vercel, Google, GitHub, Slack
```
mcp__rube__RUBE_SEARCH_TOOLS → Find tool
mcp__rube__RUBE_MANAGE_CONNECTIONS → Connect
mcp__rube__RUBE_MULTI_EXECUTE_TOOL → Execute
```

## Browser Testing

Use `agent-browser` for web testing:
```bash
agent-browser open <url>
agent-browser snapshot -i    # Get elements with refs
agent-browser click @e1      # Interact by ref
agent-browser screenshot
```

## Workflow

1. Plan first (shift+tab twice for plan mode)
2. Research docs before coding (Context7 MCP or WebFetch)
3. Implement
4. Test with `/verify-app`
5. Commit with `/commit-push-pr`

## Key Commands

- `/guide` - Step-by-step feature workflow
- `/research` - Check docs before coding
- `/verify-app` - Run tests
- `/commit-push-pr` - Git workflow
- `/learn` - Save implementation as skill

## /guide Workflow (9 Phases)

```
0. Explore    → Task(Explore) - understand codebase first
1. Detect     → New project? /create-prd. Existing? Skip to 2
2. Research   → /research - docs before code
3. UX         → prd-to-ux skill (if UI feature)
4. Plan       → /prime + /plan
5. Execute    → Fresh context, implement
6. Verify     → /code-review → /verify-app → @code-simplifier
7. Quality    → Automated checks
8. Ship       → /commit-push-pr
9. Learn      → /learn to save for reuse
```

Run `/guide` and follow the prompts. State saved in `.claude/guide-state.json`.

## /learn - Save Implementations

After building something reusable (Stripe, auth, email), save it:

```bash
/learn 'stripe-payments'
```

Creates `~/.claude/skills/stripe-payments.md` with:
- Setup code, env vars, common patterns
- Framework-specific variations
- Gotchas and testing

Next project: "Add Stripe" → uses saved skill instantly.

## Skills (in ~/.claude/skills/)

Skills are reference docs, not auto-triggered. Use when relevant:
- `auth.md` - Authentication patterns
- `react-best-practices/` - React/Next.js optimization (45 rules)
- `web-design-guidelines/` - Accessibility/UX (100+ rules)
- `agent-browser/` - Browser automation
- `livekit-deployment.md` - LiveKit agents deployment checklist

## Pre-Deployment Rules (MANDATORY)

**Before ANY deployment to Railway/Vercel/Cloud:**

1. **Trace ALL dependencies** - Run parallel agents to audit:
   ```
   grep -r "os\.getenv\|os\.environ" *.py
   ```
2. **Check imported modules** - Each import may have its own env vars
3. **Research docs FIRST** - Use WebSearch/WebFetch before coding
4. **Create env var checklist** - Document ALL required variables
5. **Validate against target** - Ensure all vars set in deployment platform

**NEVER deploy incrementally fixing errors one at a time.**

## Permissions

Defined in `settings.json`. Auto-approves most operations.
Blocks: Stripe, Resend emails, prod deploys, force push, db reset.

## Session Handoff

Before ending a long session, create handoff at:
`~/.claude/handoffs/NEXT_SESSION_START_HERE.md`

Resume with: `/resume`
